\hypertarget{md__io_t_oplossing_autotoc_md17}{}\doxysection{Inleiding}\label{md__io_t_oplossing_autotoc_md17}
Meerdere ESP32-\/microcontrollers kunnen in combinatie met Node-\/\+Red worden gebruikt om een visuele interface te bouwen op basis van de gegevens die zijn gelogd door de ESP32. Elke ESP32 kan worden geconfigureerd om gegevens van een specifieke sensor of apparaat te loggen en deze via Wi-\/\+Fi naar Node-\/\+Red te verzenden. Node-\/\+Red kan vervolgens de gegevens ontvangen en verwerken met behulp van verschillende nodes.

Al deze informatie moet vervolgens worden opgeslagen in een database, zodat de gegevens kunnen worden opgevraagd van de testpersonen en sensoren.\hypertarget{md__io_t_oplossing_autotoc_md18}{}\doxysection{Doel}\label{md__io_t_oplossing_autotoc_md18}
Het opzetten van een systeem waarbij meerdere ESP32-\/microcontrollers worden gebruikt om gegevens naar Node-\/\+Red te verzenden voor visualisatie en verwerking.

Het vervolg hierop is alle gegevens vanaf Node-\/\+Red weer door te sturen naar een database.\hypertarget{md__io_t_oplossing_autotoc_md19}{}\doxysection{Onderbouwing keuze ESP32 C3}\label{md__io_t_oplossing_autotoc_md19}
Wij kiezen voor een ESP32 omdat deze de volgende voordelen biedt\+:


\begin{DoxyItemize}
\item Relatief goedkoop (€2 per stuk).
\item Beschikbaarheid (1300 op voorraad bij Mouser, afhankelijk van het model).
\item Geschikt voor de taken die moeten worden uitgevoerd.
\item Compact formaat.
\end{DoxyItemize}\hypertarget{md__io_t_oplossing_autotoc_md20}{}\doxysection{Waarom geen Arduino of Raspberry Pi als computer voor de Waste\+Bin?}\label{md__io_t_oplossing_autotoc_md20}
Raspberry Pi\textquotesingle{}s zijn momenteel moeilijk verkrijgbaar, duur in aanschaf voor een testplatform en vereisen meer inspanning om op te zetten. Bovendien zijn ze vaak te krachtig voor onze doeleinden en daardoor overbodig qua rekenkracht. Arduino\textquotesingle{}s zijn redelijke alternatieven, maar duurder en beperkter dan ESP32-\/modules. Desalniettemin kunnen ESP32-\/modules via de Arduino IDE worden geprogrammeerd met behulp van de Arduino-\/codebibliotheken, indien gewenst.\hypertarget{md__io_t_oplossing_autotoc_md21}{}\doxysection{Data forwarding}\label{md__io_t_oplossing_autotoc_md21}
Data forwarding is de plaats waar alle data van de ESP32\textquotesingle{}s (of vuilnisbakken) wordt verzameld. Een mogelijke optie is het gebruik van specifieke hardware, zoals een Raspberry Pi met een broker (zoals Mosquitto) en een Node-\/\+Red-\/dashboard. Wij kiezen ervoor om de broker en het dashboard op onze lokale laptop te installeren in plaats van een Raspberry Pi te gebruiken. We hebben hiervoor meerdere redenen\+:


\begin{DoxyEnumerate}
\item We vermijden de noodzaak van een extra apparaat (Raspberry Pi). Alles op één apparaat maakt het eenvoudiger. Bovendien zijn Raspberry Pi\textquotesingle{}s moeilijk verkrijgbaar en vormen ze een extra bron van potentiële hardwarefouten (zoals SD-\/kaartcorruptie) en softwareproblemen (Linux-\/problemen) enzovoort.
\item Als we fysiek ergens anders willen werken, zouden we steeds de Raspberry Pi moeten verbinden met het netwerk op die locatie via een beeldscherm en toetsenbord.
\item De Raspberry Pi kan een beveiligingsrisico vormen.
\item Op het moment van schrijven is het erg lastig om aan Raspberry Pi\textquotesingle{}s te komen i.\+v.\+m. het chip te kort.
\end{DoxyEnumerate}

Stappenplan\+:


\begin{DoxyEnumerate}
\item ESP32-\/gegevens laten versturen (verbinding maken met internet).
\item Opzetten van een MQTT-\/broker om de gegevens door te sturen.
\item De MQTT-\/broker accepteert de gegevens van de ESP32.
\item De MQTT-\/broker stuurt gegevens door naar Node-\/\+Red (lokaal).
\item Inkomende gegevens van de MQTT-\/broker worden omgezet naar een dashboardweergave.
\item Data van Node-\/\+Red doorsturen naar een database.
\item De broker word op een externe computer gedraaid die dag en nacht gegevens doorzend naar Node-\/\+Red en de database
\end{DoxyEnumerate}\hypertarget{md__io_t_oplossing_autotoc_md22}{}\doxysection{De Data}\label{md__io_t_oplossing_autotoc_md22}
De volgende gegevens willen we versturen vanaf de ESP32\+:


\begin{DoxyItemize}
\item Temperatuur (dubbel)
\item Luchtvochtigheid (dubbel)
\item Klepstand (boolean)
\item Foutcodes (integer)
\item Waste\+Bin-\/\+ID (macadres)
\end{DoxyItemize}

Deze gegevens worden via MQTT naar Node-\/\+Red verzonden. Van daaruit worden de gegevens doorgestuurd naar een SQLite-\/database. We hebben gekozen voor SQLite vanwege de handige SQLite\+Studio-\/omgeving waarin we de database gemakkelijk kunnen ontwerpen, opbouwen en testen.

 
\begin{DoxyImage}
\includegraphics[width=\textwidth,height=\textheight/2,keepaspectratio=true]{Datastream.png}
\doxyfigcaption{Datastream}
\end{DoxyImage}
   \hypertarget{md__io_t_oplossing_autotoc_md23}{}\doxysection{Meldingen voor de gebruiker}\label{md__io_t_oplossing_autotoc_md23}
Voor onze opstelling willen we een luidspreker gebruiken als indicator die verschillende waarschuwingen kan afgeven wanneer dat nodig is. Deze waarschuwingen zijn onder andere\+:


\begin{DoxyItemize}
\item De klep staat te lang open (mogelijk)
\item De binnenkant van de bak is te warm (mogelijk klep open of slechte koeling)
\item Algemene fout (ander probleem)
\end{DoxyItemize}

We hebben ervoor gekozen om deze waarschuwingen ook naar ons dashboard te sturen als ze zich voordoen. Deze waarschuwingen worden weergegeven als foutcodes.\hypertarget{md__io_t_oplossing_autotoc_md24}{}\doxysection{Verstuur interval}\label{md__io_t_oplossing_autotoc_md24}
In principe worden alle gegevens elke 15 minuten verstuurd. We denken dat dit voldoende informatie is voor elke vuilnisbak om eventuele problemen te detecteren (bijvoorbeeld te lage temperatuur). Bovendien voorkomt dit dat de database overvol raakt met gegevens, vooral wanneer er 30 vuilnisbakken zijn.\hypertarget{md__io_t_oplossing_autotoc_md25}{}\doxysubsection{In geval van fouten}\label{md__io_t_oplossing_autotoc_md25}
In geval van een fout wordt dit interval genegeerd. Het interval wordt dan 2 minuten, indien er zich één of meerdere fouten blijven voordoen.\hypertarget{md__io_t_oplossing_autotoc_md26}{}\doxysection{Node-\/\+Red}\label{md__io_t_oplossing_autotoc_md26}
We zullen Node-\/\+Red gebruiken om alle gegevens van MQTT te ontvangen, te verwerken en weer te geven. Alle ontvangen informatie wordt weergegeven via een Node-\/\+Red UI-\/tabblad. Dit UI-\/tabblad, ook wel \char`\"{}dashboard\char`\"{} genoemd in Node-\/\+Red, is uitbreidbaar indien gewenst. Alle prototype vuilnisbakken kunnen in real-\/time worden weergegeven op het dashboard als dat gewenst is.

De Node-\/\+Red UI ziet er als volgt uit voor twee vuilnisbakken\+:

 
\begin{DoxyImage}
\includegraphics[width=\textwidth,height=\textheight/2,keepaspectratio=true]{node-red-ui.png}
\doxyfigcaption{Node-\/\+Red UI}
\end{DoxyImage}
   \hypertarget{md__io_t_oplossing_autotoc_md27}{}\doxysubsection{Node-\/\+Red flow}\label{md__io_t_oplossing_autotoc_md27}
Om dit alles te laten werken, hebben we een Node-\/\+Red flow gemaakt. De Node-\/\+Red flow ziet er als volgt uit\+:

 
\begin{DoxyImage}
\includegraphics[width=\textwidth,height=\textheight/2,keepaspectratio=true]{node-red-setup.png}
\doxyfigcaption{Node-\/\+Red setup}
\end{DoxyImage}
   

In deze flow ontvangt de eerste node (paars) de MQTT-\/gegevens. Vervolgens wordt er een tijdstempel aan het bericht toegevoegd en worden alle inkomende berichten gescheiden met behulp van een schakelaar (switch). De gegevens worden gescheiden op basis van het macadres (uniek) van de vuilnisbak.

Nadat de berichten zijn gescheiden, komen ze in een grote functieblok (oranje) dat het bericht analyseert en verdeelt over de uit puts van het functieblok. Ik heb hiervoor gekozen, zodat het functieblok modulair blijft en de uitvoer flexibel is. De uitvoer wordt gestuurd naar dashboardblokken (blauw) en naar nieuwe functieblokken die extra gegevens toevoegen (zoals sensor-\/\+ID) en deze als query naar een SQLite-\/database sturen.\hypertarget{md__io_t_oplossing_autotoc_md28}{}\doxysection{Database}\label{md__io_t_oplossing_autotoc_md28}
Alle informatie wordt via Node-\/\+Red doorgestuurd naar een SQLite-\/database. Het doel van de database is om een doorzoekbare geschiedenis van alle ontvangen gegevens van de vuilnisbakken te creëren en een overzicht te bieden van alle gebruikers (testpersonen) en hun gegevens.

De database is als volgt opgebouwd\+:

 
\begin{DoxyImage}
\includegraphics[width=\textwidth,height=\textheight/2,keepaspectratio=true]{WasteBinDBER.png}
\doxyfigcaption{Databaseontwerp}
\end{DoxyImage}
   

Hierbij zijn alle onderstreepte woorden sleutelwaarden. Helaas toont het Database Entity Relationship-\/diagram (DBER) niet alle details, maar het geeft wel een goed overzicht van de databasestructuur.\hypertarget{md__io_t_oplossing_autotoc_md29}{}\doxysubsection{sensor Table}\label{md__io_t_oplossing_autotoc_md29}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endhead
sensor\+\_\+idnr   &INTEGER   &PRIMARY KEY    \\\cline{1-3}
sensor\+\_\+type   &TEXT   &NOT NULL, UNIQUE    \\\cline{1-3}
sensor\+\_\+unit   &TEXT   &NOT NULL   \\\cline{1-3}
\end{longtabu}
\hypertarget{md__io_t_oplossing_autotoc_md30}{}\doxysubsection{sensordata Table}\label{md__io_t_oplossing_autotoc_md30}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endhead
mac\+\_\+address   &TEXT   &NOT NULL, FOREIGN KEY REFERENCES wastebin(mac\+\_\+adress)    \\\cline{1-3}
sensor\+\_\+idnr   &INTEGER   &NOT NULL    \\\cline{1-3}
sensor\+\_\+value   &INTEGER   &NOT NULL    \\\cline{1-3}
timestamp   &TEXT   &NOT NULL   \\\cline{1-3}
\end{longtabu}
\hypertarget{md__io_t_oplossing_autotoc_md31}{}\doxysubsection{settings Table}\label{md__io_t_oplossing_autotoc_md31}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endhead
mac\+\_\+adress   &TEXT   &FOREIGN KEY REFERENCES wastebin(mac\+\_\+adress)    \\\cline{1-3}
SSID   &TEXT   &NOT NULL    \\\cline{1-3}
password   &TEXT   &\\\cline{1-3}
mqtt\+\_\+server   &TEXT   &NOT NULL    \\\cline{1-3}
mqtt\+\_\+username   &TEXT   &\\\cline{1-3}
mqtt\+\_\+password   &TEXT   &\\\cline{1-3}
mqtt\+\_\+port   &INTEGER   &NOT NULL    \\\cline{1-3}
sensor\+\_\+data\+\_\+topic   &TEXT   &NOT NULL   \\\cline{1-3}
\end{longtabu}
\hypertarget{md__io_t_oplossing_autotoc_md32}{}\doxysubsection{testperson Table}\label{md__io_t_oplossing_autotoc_md32}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endhead
idnr   &INTEGER   &PRIMARY KEY    \\\cline{1-3}
surname   &TEXT   &NOT NULL    \\\cline{1-3}
birthyear   &INTEGER   &\\\cline{1-3}
nrofroommates   &INTEGER   &\\\cline{1-3}
postalcode   &TEXT   &NOT NULL    \\\cline{1-3}
housenr   &TEXT   &NOT NULL    \\\cline{1-3}
streetname   &TEXT   &NOT NULL   \\\cline{1-3}
\end{longtabu}
\hypertarget{md__io_t_oplossing_autotoc_md33}{}\doxysubsection{wastebin Table}\label{md__io_t_oplossing_autotoc_md33}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Column Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Data Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Constraints    }\\\cline{1-3}
\endhead
mac\+\_\+adress   &TEXT   &FOREIGN KEY REFERENCES testperson(idnr)    \\\cline{1-3}
testperson   &INTEGER   &PRIMARY KEY    \\\cline{1-3}
wastebinnr   &INTEGER   &UNIQUE NOT NULL   \\\cline{1-3}
\end{longtabu}


Dit is de tabelstructuur voor de database, waarbij elke tabel de bijbehorende velden en datatypes bevat. De tabelrelaties zijn aangegeven met \char`\"{}\+PRIMARY KEY\char`\"{} en \char`\"{}\+FOREIGN KEY\char`\"{} om de verbanden tussen de tabellen weer te geven.

De database kan worden doorzocht met behulp van \char`\"{}views\char`\"{} in SQLite\+Studio. Deze kunnen door de gebruiker worden gemaakt en aangepast.

Dit is een overzicht van de opzet voor het gebruik van meerdere ESP32-\/microcontrollers met Node-\/\+Red. Met deze configuratie kunnen we gegevens loggen van verschillende sensoren of apparaten, deze visualiseren op een dashboard en ze opslaan in een database voor verdere analyse en beheer.\hypertarget{md__io_t_oplossing_autotoc_md34}{}\doxysection{Views}\label{md__io_t_oplossing_autotoc_md34}
Er zijn 3 views beschikbaar gemaakt voor de database.

Deze views zijn gemaakt om een sneller en beter inzicht te krijgen in bepaalde data combinaties.

Hier is een Markdown representatie van de drie views\+:\hypertarget{md__io_t_oplossing_autotoc_md35}{}\doxysubsection{View 1 \+: view\+\_\+al\+\_\+testpersons\+\_\+with\+\_\+wastebinnr}\label{md__io_t_oplossing_autotoc_md35}

\begin{DoxyCode}{0}
\DoxyCodeLine{SELECT tp.*,}
\DoxyCodeLine{       wb.wastebinnr}
\DoxyCodeLine{  FROM testperson AS tp}
\DoxyCodeLine{       JOIN}
\DoxyCodeLine{       wastebin AS wb ON tp.idnr = wb.testperson}

\end{DoxyCode}


Deze query selecteert alle kolommen ({\ttfamily $\ast$}) uit de {\ttfamily testperson}-\/tabel en voegt de kolom {\ttfamily wastebinnr} uit de {\ttfamily wastebin}-\/tabel toe. De JOIN-\/operatie wordt uitgevoerd op basis van de overeenkomstige {\ttfamily idnr}-\/kolommen tussen de {\ttfamily testperson}-\/ en {\ttfamily wastebin}-\/tabellen.\hypertarget{md__io_t_oplossing_autotoc_md36}{}\doxysubsection{View 2\+: view\+\_\+all\+\_\+sensors\+\_\+data}\label{md__io_t_oplossing_autotoc_md36}

\begin{DoxyCode}{0}
\DoxyCodeLine{SELECT s.sensor\_type,}
\DoxyCodeLine{       CASE WHEN sensor\_type = "{}lidposition"{} AND }
\DoxyCodeLine{                 sd.sensor\_value = 1 THEN 'closed' WHEN sensor\_type = "{}lidposition"{} AND }
\DoxyCodeLine{                                                        sd.sensor\_value = 0 THEN 'open' ELSE sd.sensor\_value END AS sensorvalue,}
\DoxyCodeLine{       sd.timestamp,}
\DoxyCodeLine{       sd.mac\_address}
\DoxyCodeLine{  FROM sensor AS s}
\DoxyCodeLine{       JOIN}
\DoxyCodeLine{       sensordata AS sd ON s.sensor\_idnr = sd.sensor\_idnr}

\end{DoxyCode}


Deze query selecteert de kolommen {\ttfamily sensor\+\_\+type}, {\ttfamily sensorvalue}, {\ttfamily timestamp} en {\ttfamily mac\+\_\+address}. De {\ttfamily CASE}-\/expressie wordt gebruikt om de waarde van {\ttfamily sensorvalue} te bepalen op basis van voorwaarden. De JOIN-\/operatie wordt uitgevoerd op basis van de overeenkomstige {\ttfamily sensor\+\_\+idnr}-\/kolommen tussen de {\ttfamily sensor}-\/ en {\ttfamily sensordata}-\/tabellen.\hypertarget{md__io_t_oplossing_autotoc_md37}{}\doxysubsection{View 3\+: view\+\_\+all\+\_\+wastebin\+\_\+settings}\label{md__io_t_oplossing_autotoc_md37}

\begin{DoxyCode}{0}
\DoxyCodeLine{SELECT w.wastebinnr,}
\DoxyCodeLine{       w.mac\_adress,}
\DoxyCodeLine{       s.SSID,}
\DoxyCodeLine{       s.password,}
\DoxyCodeLine{       s.mqtt\_server,}
\DoxyCodeLine{       s.mqtt\_username,}
\DoxyCodeLine{       s.mqtt\_password,}
\DoxyCodeLine{       s.mqtt\_port,}
\DoxyCodeLine{       s.sensor\_data\_topic,}
\DoxyCodeLine{       w.testperson}
\DoxyCodeLine{  FROM wastebin AS w}
\DoxyCodeLine{       JOIN}
\DoxyCodeLine{       settings AS s ON w.mac\_adress = s.mac\_adress}

\end{DoxyCode}


Deze query selecteert verschillende kolommen uit de {\ttfamily wastebin}-\/ en {\ttfamily settings}-\/tabellen. De JOIN-\/operatie wordt uitgevoerd op basis van de overeenkomstige {\ttfamily mac\+\_\+address}-\/kolommen tussen de twee tabellen.

De bovenstaande weergave is bedoeld om de query\textquotesingle{}s in een leesbare vorm te presenteren.

Er word aangemoedigd om de views uit te breiden of aan te passen naar wens van de gebruiker.\hypertarget{md__io_t_oplossing_autotoc_md38}{}\doxysection{Alle Query\textquotesingle{}s}\label{md__io_t_oplossing_autotoc_md38}
Met al deze Query\textquotesingle{}s is de database opnieuw op te bouwen mocht dit gewenst zijn.


\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/ WasteBinData Database}
\DoxyCodeLine{}
\DoxyCodeLine{-\/-\/ Tabel: sensor}
\DoxyCodeLine{CREATE TABLE sensor (}
\DoxyCodeLine{  sensor\_idnr INTEGER PRIMARY KEY,}
\DoxyCodeLine{  sensor\_type TEXT NOT NULL UNIQUE,}
\DoxyCodeLine{  sensor\_unit TEXT NOT NULL}
\DoxyCodeLine{);}
\DoxyCodeLine{}
\DoxyCodeLine{-\/-\/ Tabel: sensordata}
\DoxyCodeLine{CREATE TABLE sensordata (}
\DoxyCodeLine{  mac\_address TEXT NOT NULL REFERENCES wastebin (mac\_adress),}
\DoxyCodeLine{  sensor\_idnr INTEGER NOT NULL,}
\DoxyCodeLine{  sensor\_value INTEGER NOT NULL,}
\DoxyCodeLine{  timestamp TEXT NOT NULL}
\DoxyCodeLine{);}
\DoxyCodeLine{}
\DoxyCodeLine{-\/-\/ Tabel: settings}
\DoxyCodeLine{CREATE TABLE settings (}
\DoxyCodeLine{  mac\_adress TEXT REFERENCES wastebin (mac\_adress),}
\DoxyCodeLine{  SSID TEXT NOT NULL,}
\DoxyCodeLine{  password TEXT,}
\DoxyCodeLine{  mqtt\_server TEXT NOT NULL,}
\DoxyCodeLine{  mqtt\_username TEXT,}
\DoxyCodeLine{  mqtt\_password TEXT,}
\DoxyCodeLine{  mqtt\_port INTEGER NOT NULL,}
\DoxyCodeLine{  sensor\_data\_topic TEXT NOT NULL}
\DoxyCodeLine{);}
\DoxyCodeLine{}
\DoxyCodeLine{-\/-\/ Tabel: testperson}
\DoxyCodeLine{CREATE TABLE testperson (}
\DoxyCodeLine{  idnr INTEGER PRIMARY KEY,}
\DoxyCodeLine{  surname TEXT NOT NULL,}
\DoxyCodeLine{  birthyear INTEGER,}
\DoxyCodeLine{  nrofroommates INTEGER,}
\DoxyCodeLine{  postalcode TEXT NOT NULL,}
\DoxyCodeLine{  housenr TEXT NOT NULL,}
\DoxyCodeLine{  streetname TEXT NOT NULL}
\DoxyCodeLine{);}
\DoxyCodeLine{}
\DoxyCodeLine{-\/-\/ Tabel: wastebin}
\DoxyCodeLine{CREATE TABLE wastebin (}
\DoxyCodeLine{  mac\_adress TEXT REFERENCES testperson (idnr),}
\DoxyCodeLine{  testperson INTEGER PRIMARY KEY,}
\DoxyCodeLine{  wastebinnr INTEGER UNIQUE NOT NULL}
\DoxyCodeLine{);}
\DoxyCodeLine{}
\DoxyCodeLine{-\/-\/ WasteBin Views}
\DoxyCodeLine{}
\DoxyCodeLine{-\/-\/ View: view\_al\_testpersons\_with\_wastebinnr}
\DoxyCodeLine{CREATE VIEW view\_al\_testpersons\_with\_wastebinnr AS}
\DoxyCodeLine{SELECT tp.*, wb.wastebinnr}
\DoxyCodeLine{FROM testperson AS tp}
\DoxyCodeLine{JOIN wastebin AS wb ON tp.idnr = wb.testperson;}
\DoxyCodeLine{}
\DoxyCodeLine{-\/-\/ View: view\_all\_sensors\_data}
\DoxyCodeLine{CREATE VIEW view\_all\_sensors\_data AS}
\DoxyCodeLine{SELECT s.sensor\_type,}
\DoxyCodeLine{  CASE}
\DoxyCodeLine{    WHEN sensor\_type = 'lidposition' AND sd.sensor\_value = 1 THEN 'closed'}
\DoxyCodeLine{    WHEN sensor\_type = 'lidposition' AND sd.sensor\_value = 0 THEN 'open'}
\DoxyCodeLine{    ELSE sd.sensor\_value}
\DoxyCodeLine{  END AS sensorvalue,}
\DoxyCodeLine{  sd.timestamp,}
\DoxyCodeLine{  sd.mac\_address}
\DoxyCodeLine{FROM sensor AS s}
\DoxyCodeLine{JOIN sensordata AS sd ON s.sensor\_idnr = sd.sensor\_idnr;}
\DoxyCodeLine{}
\DoxyCodeLine{-\/-\/ View: view\_all\_wastebin\_settings}
\DoxyCodeLine{CREATE VIEW view\_all\_wastebin\_settings AS}
\DoxyCodeLine{SELECT w.wastebinnr,}
\DoxyCodeLine{  w.mac\_adress,}
\DoxyCodeLine{  s.SSID,}
\DoxyCodeLine{  s.password,}
\DoxyCodeLine{  s.mqtt\_server,}
\DoxyCodeLine{  s.mqtt\_username,}
\DoxyCodeLine{  s.mqtt\_password,}
\DoxyCodeLine{  s.mqtt\_port,}
\DoxyCodeLine{  s.sensor\_data\_topic,}
\DoxyCodeLine{  w.testperson}
\DoxyCodeLine{FROM wastebin AS w}
\DoxyCodeLine{JOIN settings AS s ON w.mac\_adress = s.mac\_adress;}

\end{DoxyCode}
 